{% extends "main_page.html" %}
{% block MAIN_PAGE %}

{% include "_form_filter_date.html" %}

<div>
  <table class="table table-striped-columns">
    <thead>
      <tr>
        <th scope="col">Data</th>
        <th scope="col">Travel start</th>
        <th scope="col">Travel end</th>

        <th scope="col">Work start </th>
        <th scope="col">Work end </th>

        <th scope="col">Worktimes standard</th>

        <th scope="col">Project</th>
        <th scope="col">Netz/Vor</th>

        <th scope="col">Action</th>
      </tr>
    </thead>
    <tbody id="id_week_overview_js">

    </tbody>
  </table>
</div>

{% endblock %}

<!-- ============================================================ -->

{% block JAVASCRIPT_EXTEND %}

{% load static %}
{{ iso_date_list|json_script:"list_data" }}
{{ json_weekhours|json_script:"object_data"}}
<script>

  const COLS_AMOUNT = 8;
  const BASE_LINK = "/a20_users/xday_overview/";

  function createTabele(tablebody, datatime, objectData) {
    let newRowTr = document.createElement("tr");
    let newRowArray = [];
    for (let i = 0; i < COLS_AMOUNT; ++i) {
      let newTD = document.createElement("td");
      newRowArray.push(newTD);
    }
    var newColTd9_a = document.createElement("a");

    newRowArray.forEach(function (item) { newRowTr.appendChild(item); });
    newRowTr.appendChild(newColTd9_a);

    if (objectData && (datatime === objectData?.date)) {
      newColTd1_data.innerText = datatime;
      newColTd2_travelStart.innerText = objectData.travel_start;
      newColTd3_travelEnd.innerText = objectData.travel_end;
      newColTd4_workStart.innerText = objectData.work_start;
      newColTd5_workEnd.innerText = objectData.work_end;
      newColTd6_standardTime.innerText = objectData.workimes_standard__description;
      newColTd7_projectMachine.innerText = objectData.project_machine;
      newColTd8_netzVorgang.innerText = objectData.netzplan_vorgang;

      console.log(objectData.workimes_standard__description)

      var link = document.createTextNode("change");
      newColTd9_a.appendChild(link);
      newColTd9_a.title = "change";
      newColTd9_a.href = `${BASE_LINK}${datatime}`;
    }
    else {
      newColTd1_data.innerText = datatime;
      newColTd2_travelStart.innerText = "--";
      newColTd3_travelEnd.innerText = "--"
      newColTd4_workStart.innerText = "--";
      newColTd5_workEnd.innerText = "--";
      newColTd6_standardTime.innerText = "--";
      newColTd7_projectMachine.innerText = "--";
      newColTd8_netzVorgang.innerText = "--";

      var link = document.createTextNode("add-new");
      newColTd9_a.appendChild(link);
      newColTd9_a.title = "add-new";
      newColTd9_a.href = `${BASE_LINK}${datatime}`;
    }
    lastDate = datatime

    tablebody.appendChild(newRowTr);
  }

  var htbody = document.querySelector("tbody[id=id_week_overview_js]");

  var hListData = JSON.parse(document.getElementById("list_data").textContent);
  var hObjectData = JSON.parse(document.getElementById("object_data").textContent);

  var lastDate = hListData[0]
  if (hObjectData) {
    var j = 0;
    for (let i = 0; i < hListData.length; ++i) {
      createTabele(htbody, hListData[i], hObjectData[j]);


      if (hListData[i] === hObjectData[j]?.date) j++;
      lastDate = hListData[j]
    }
  }
  else {
    for (let i = 0; i < hListData.length; ++i) createTabele(htbody, hListData[i], null);
  }

</script>

{% endblock %}